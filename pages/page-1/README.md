# 案例：拖拽

该案例来源于<https://jerryzou.com/posts/rxjs-practice-01/>

## 1. 简单的拖拽

> **需求**：给定一个小方块，实现简单的拖拽功能，要求鼠标在小方块上按下后能够拖着小方块进行移动；鼠标放开后，则运动停止。

### 代码亮点

[代码](src/simple.ts)

- 通过使用 takeUntil(mouseup) 代替手动取消订阅 mousemove 事件更加优雅一点
- 通过 switchMap 把 move 事件抬升到 down 事件下，使 mousedown 和 mousemove 合为一体

### 2. 添加初始延迟

> **需求**：在拖拽的实际应用中，有时会希望有个初始延迟。就像手机屏幕上的诸多 App 图标，在你想要拖拽它们进行排序时，通常需要按住图标一小段时间，比如 500ms，这时该如何操作呢？

#### 代码亮点

[代码](src/delay.ts)

- 转换控制权
  1. 用 of 生成新的内部 Observable，并添加延时以及设置无效条件控制
  2. 把控制权转为函数内部，并使用 switchMap 把内部事件抬升到外部
- 使用 tap 作为事件触发器

### 3. 拖拽接龙

> **需求**：给定 n 个小方块，要求拖拽第一个小方块进行移动，后续的小方块能够以间隔 0.1s 的时间跟着之前的小方块进行延迟模仿运动。

#### 代码亮点

[代码](src/solitaire.ts)

- 使用 zip 把 dom 和 interval 延时链接起来
- startWith 让第一个立即启动
- 使用 mergeMap 把自拖动后的所有的坐标点都遍历一次
